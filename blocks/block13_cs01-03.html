<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>American History — Block 13 (CS 1–3) Game</title>
<style>
  :root{
    --bg:#0b1220; --card:#111a2e; --ink:#e7eefc; --muted:#a8b4cf;
    --accent:#7aa2ff; --good:#2bd576; --bad:#ff5c7a; --warn:#ffd166;
    --border:rgba(255,255,255,.12); --shadow:0 18px 55px rgba(0,0,0,.35);
    --r:18px;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    background:radial-gradient(1000px 650px at 18% 12%, rgba(122,162,255,.18), transparent 60%), var(--bg);
    color:var(--ink); min-height:100vh;
    display:flex; align-items:center; justify-content:center; padding:18px;
  }
  .app{width:min(980px,100%); background:rgba(17,26,46,.92); border:1px solid var(--border);
    border-radius:var(--r); box-shadow:var(--shadow); overflow:hidden}
  header{padding:16px 18px; display:flex; gap:12px; align-items:flex-start; justify-content:space-between;
    border-bottom:1px solid var(--border);
    background:linear-gradient(180deg, rgba(255,255,255,.06), transparent)}
  .title{display:flex; flex-direction:column; gap:4px}
  .title h1{margin:0; font-size:16px; letter-spacing:.2px}
  .title .sub{color:var(--muted); font-size:12px; line-height:1.3}
  .meta{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; align-items:center}
  .pill{border:1px solid var(--border); border-radius:999px; padding:6px 10px; font-size:12px; color:var(--muted); background:rgba(0,0,0,.18)}
  .pill b{color:var(--ink); font-weight:800}
  main{padding:18px; display:grid; gap:14px}
  .card{background:rgba(0,0,0,.22); border:1px solid var(--border); border-radius:var(--r); padding:16px}
  .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between}
  label{font-size:12px; color:var(--muted)}
  input[type="text"]{
    width:min(420px,100%); padding:10px 12px; border-radius:12px;
    border:1px solid var(--border); background:rgba(0,0,0,.25); color:var(--ink);
    outline:none;
  }
  button{
    cursor:pointer; border:none; border-radius:14px; padding:12px 12px;
    font-weight:900; color:var(--ink); background:rgba(122,162,255,.18);
    border:1px solid rgba(122,162,255,.35);
    transition:transform .08s ease, filter .12s ease;
  }
  button:hover{filter:brightness(1.06)}
  button:active{transform:scale(.99)}
  button.secondary{background:rgba(255,255,255,.06); border:1px solid var(--border); color:var(--muted)}
  button.good{background:rgba(43,213,118,.14); border:1px solid rgba(43,213,118,.35)}
  button.bad{background:rgba(255,92,122,.14); border:1px solid rgba(255,92,122,.35)}
  .qTop{display:flex; align-items:flex-start; justify-content:space-between; gap:10px}
  .kicker{color:var(--muted); font-size:12px}
  .qTitle{margin:0; font-size:14px; line-height:1.35}
  .status{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
  .bar{height:10px; background:rgba(255,255,255,.08); border-radius:999px; overflow:hidden; border:1px solid var(--border); width:220px}
  .bar>div{height:100%; width:0%; background:rgba(43,213,118,.75)}
  .grid{
    display:grid; gap:10px; margin-top:10px;
    grid-template-columns:repeat(2, minmax(0,1fr));
  }
  @media (max-width:640px){ .grid{grid-template-columns:1fr} }
  .hint{
    margin-top:10px; padding:10px 12px; border-radius:14px;
    background:rgba(255,209,102,.10); border:1px solid rgba(255,209,102,.35);
    display:none;
  }
  .hint .small{color:var(--muted); font-size:12px; margin-top:4px; line-height:1.35}
  .toast{font-size:12px; color:var(--muted)}
  .hidden{display:none !important}
  pre{
    white-space:pre-wrap; word-break:break-word;
    background:rgba(0,0,0,.25); border:1px solid var(--border); padding:12px; border-radius:14px;
    color:var(--ink); font-size:12px; line-height:1.35; margin:10px 0 0;
  }
</style>
</head>
<body>
<div class="app" role="application" aria-label="American History Block 13 Game">
  <header>
    <div class="title">
      <h1>American History — Block 13 Game (CS 1–3)</h1>
      <div class="sub">Historical Thinking & Skills • Perfect run required • Hint only after a miss • Auto-advance on correct • Choices reshuffle after a miss</div>
    </div>
    <div class="meta">
      <div class="pill">Name: <b id="mName">—</b></div>
      <div class="pill">Started: <b id="mStart">—</b></div>
      <div class="pill">Time: <b id="mTime">00:00</b></div>
      <div class="pill">Accuracy: <b id="mAcc">100%</b></div>
    </div>
  </header>

  <main>
    <section id="screenStart" class="card">
      <div class="row">
        <div>
          <div class="kicker">Enter your name to begin</div>
          <div style="margin-top:8px">
            <label for="name">Student Name</label><br/>
            <input id="name" type="text" autocomplete="name" placeholder="Type your name…" />
          </div>
        </div>
        <div style="display:flex; gap:10px; align-items:center">
          <button id="btnStart">Start</button>
          <button id="btnDemo" class="secondary">Demo</button>
        </div>
      </div>
      <div class="toast" style="margin-top:10px">
        Rule: to earn the submit ticket, you must finish with <b>0 missed questions</b> (100% first-try accuracy).
      </div>
    </section>

    <section id="screenGame" class="card hidden">
      <div class="qTop">
        <div>
          <div class="kicker" id="qKicker">Question</div>
          <p class="qTitle" id="qText">—</p>
        </div>
        <div class="status">
          <div class="bar"><div id="barFill"></div></div>
          <div class="toast"><span id="qCount">0</span>/<span id="qTotal">0</span></div>
        </div>
      </div>

      <div class="grid" id="choices"></div>

      <div class="hint" id="hintBox" role="note" aria-label="Hint">
        <div><b>Hint (only after a miss):</b></div>
        <div id="hintText" style="margin-top:6px"></div>
        <div class="small" id="hintSmall"></div>
      </div>

      <div class="row" style="margin-top:14px">
        <div class="toast" id="feedback">—</div>
        <div style="display:flex; gap:10px">
          <button id="btnReset" class="secondary">Reset</button>
        </div>
      </div>
    </section>

    <section id="screenDone" class="card hidden">
      <div class="row">
        <div>
          <h2 id="doneTitle" style="margin:0 0 6px; font-size:16px;">Complete ✅</h2>
          <div class="toast" id="doneMsg">Perfect run achieved. Copy your submit ticket.</div>
        </div>
        <div style="display:flex; gap:10px">
          <button id="btnCopy" class="good">Copy Ticket</button>
          <button id="btnPlayAgain" class="secondary">Play Again</button>
        </div>
      </div>
      <pre id="logOut"></pre>
    </section>
  </main>
</div>

<script>
/* =========
   QUESTIONS — Block 13 (CS 1–3)
   ========= */
const QUESTIONS = [

/* =========================
   CS1 — SOURCE CREDIBILITY
   ========================= */

{
  cs:"CS1",
  prompt:"A historian finds a 1915 newspaper article praising a factory owner written by the owner's cousin. Which credibility check is MOST important?",
  choices:[
    "Circumstances in which the source was created",
    "Sequence of events described",
    "Whether it is primary",
    "Length of the article"
  ],
  answer:"Circumstances in which the source was created",
  hint:{why:"Conflicts of interest affect reliability.", keyPoints:["Context","Conflict of interest"]}
},

{
  cs:"CS1",
  prompt:"Which of the following is NOT typically used to evaluate credibility?",
  choices:[
    "Author qualifications",
    "Agreement with reliable sources",
    "Use of stereotypes",
    "Font style and formatting"
  ],
  answer:"Font style and formatting",
  hint:{why:"Appearance does not determine reliability.", keyPoints:["Content over appearance"]}
},

{
  cs:"CS1",
  prompt:"A biased political cartoon is MOST useful for understanding:",
  choices:[
    "Public attitudes at the time",
    "Precise economic statistics",
    "Neutral reporting",
    "Official government totals"
  ],
  answer:"Public attitudes at the time",
  hint:{why:"Bias can reveal perspective.", keyPoints:["Perspective evidence"]}
},

{
  cs:"CS1",
  prompt:"A source contradicts itself in two sections. What credibility factor is most affected?",
  choices:[
    "Internal consistency",
    "Publication date",
    "Primary classification",
    "Length"
  ],
  answer:"Internal consistency",
  hint:{why:"Contradictions weaken reliability.", keyPoints:["Consistency"]}
},

{
  cs:"CS1",
  prompt:"Two credible sources disagree about an event. What is the BEST next step?",
  choices:[
    "Compare both to additional independent evidence",
    "Dismiss both",
    "Accept the longer one",
    "Choose the more emotional account"
  ],
  answer:"Compare both to additional independent evidence",
  hint:{why:"Corroboration strengthens evaluation.", keyPoints:["Cross-check"]}
},

{
  cs:"CS1",
  prompt:"A website article lists no author and no citations. Which credibility factor is MOST concerning?",
  choices:[
    "Author qualifications and reputation",
    "Correlation",
    "Sequence",
    "Causation"
  ],
  answer:"Author qualifications and reputation",
  hint:{why:"Unknown authorship weakens credibility.", keyPoints:["Credentials"]}
},

{
  cs:"CS1",
  prompt:"A photograph shows a protest crowd. Before using it as evidence, a historian should FIRST:",
  choices:[
    "Investigate its origin and context",
    "Assume it proves unrest",
    "Reject it as unreliable",
    "Treat it as neutral"
  ],
  answer:"Investigate its origin and context",
  hint:{why:"Context determines meaning.", keyPoints:["Origin","Purpose"]}
},

{
  cs:"CS1",
  prompt:"Which situation MOST suggests bias?",
  choices:[
    "An author uses emotionally charged language and stereotypes",
    "An article includes citations",
    "A diary is written during the event",
    "A historian compares sources"
  ],
  answer:"An author uses emotionally charged language and stereotypes",
  hint:{why:"Emotional stereotyping signals bias.", keyPoints:["Bias indicators"]}
},

{
  cs:"CS1",
  prompt:"A biased source can still be valuable because it:",
  choices:[
    "Reveals attitudes and perspective",
    "Proves statistical accuracy",
    "Eliminates the need for corroboration",
    "Guarantees neutrality"
  ],
  answer:"Reveals attitudes and perspective",
  hint:{why:"Bias ≠ useless.", keyPoints:["Perspective value"]}
},

{
  cs:"CS1",
  prompt:"Which factor would LEAST strengthen a source’s credibility?",
  choices:[
    "Agreement with other reliable evidence",
    "Clear author qualifications",
    "Internal consistency",
    "Dramatic storytelling"
  ],
  answer:"Dramatic storytelling",
  hint:{why:"Emotion does not equal reliability.", keyPoints:["Substance over style"]}
},

/* =========================
   CS2 — THESIS & EVIDENCE
   ========================= */

{
  cs:"CS2",
  prompt:"Which is the strongest thesis?",
  choices:[
    "Industrialization happened.",
    "Industrialization increased production but intensified labor conflict.",
    "Factories were built.",
    "History changed."
  ],
  answer:"Industrialization increased production but intensified labor conflict.",
  hint:{why:"Specific and arguable.", keyPoints:["Interpretation"]}
},

{
  cs:"CS2",
  prompt:"Which evidence BEST refutes the claim: “The New Deal solved all economic problems.”",
  choices:[
    "Data showing continued unemployment in 1938",
    "A speech praising FDR",
    "A CCC photograph",
    "A textbook definition"
  ],
  answer:"Data showing continued unemployment in 1938",
  hint:{why:"Strong counter-evidence disproves claim.", keyPoints:["Refutation"]}
},

{
  cs:"CS2",
  prompt:"Which evidence BEST supports the claim that migration changed culture?",
  choices:[
    "Music and literature from the period",
    "A weather report",
    "An unrelated map",
    "A rumor"
  ],
  answer:"Music and literature from the period",
  hint:{why:"Cultural shifts appear in art and writing.", keyPoints:["Relevant evidence"]}
},

{
  cs:"CS2",
  prompt:"Which is NOT a characteristic of a strong thesis?",
  choices:[
    "It makes a clear claim",
    "It can be supported with evidence",
    "It lists events without interpretation",
    "It explains significance"
  ],
  answer:"It lists events without interpretation",
  hint:{why:"A thesis must interpret.", keyPoints:["Interpretation"]}
},

{
  cs:"CS2",
  prompt:"A historian changes a thesis after examining new letters. This shows:",
  choices:[
    "Refinement based on new evidence",
    "Weak research",
    "Bias",
    "Abandonment of analysis"
  ],
  answer:"Refinement based on new evidence",
  hint:{why:"Historians revise when evidence demands it.", keyPoints:["Revision"]}
},

{
  cs:"CS2",
  prompt:"Why do historians cite sources?",
  choices:[
    "To allow verification of evidence",
    "To make writing longer",
    "To guarantee agreement",
    "To avoid argument"
  ],
  answer:"To allow verification of evidence",
  hint:{why:"Citations strengthen credibility.", keyPoints:["Traceability"]}
},

{
  cs:"CS2",
  prompt:"Which evidence would LEAST support a claim about economic change?",
  choices:[
    "Employment statistics",
    "Tax records",
    "A fictional novel unrelated to economics",
    "Business ledgers"
  ],
  answer:"A fictional novel unrelated to economics",
  hint:{why:"Evidence must be relevant.", keyPoints:["Relevance"]}
},

{
  cs:"CS2",
  prompt:"Which action BEST strengthens a historical claim?",
  choices:[
    "Comparing multiple independent sources",
    "Ignoring conflicting data",
    "Using one emotional quote",
    "Repeating the thesis"
  ],
  answer:"Comparing multiple independent sources",
  hint:{why:"Comparison strengthens argument.", keyPoints:["Corroboration"]}
},

/* =========================
   CS3 — CAUSE & EFFECT
   ========================= */

{
  cs:"CS3",
  prompt:"Which example BEST represents multiple causation?",
  choices:[
    "Several economic and political factors lead to revolution",
    "One law causes change",
    "One speech causes protest",
    "A storm closes school"
  ],
  answer:"Several economic and political factors lead to revolution",
  hint:{why:"Events usually have multiple causes.", keyPoints:["Complexity"]}
},

{
  cs:"CS3",
  prompt:"Which is a long-term cause?",
  choices:[
    "Years of discriminatory laws",
    "A single protest",
    "A sudden storm",
    "A speech"
  ],
  answer:"Years of discriminatory laws",
  hint:{why:"Long-term causes build over time.", keyPoints:["Structural"]}
},

{
  cs:"CS3",
  prompt:"Which is a short-term cause?",
  choices:[
    "Immediate job opportunity",
    "Generational poverty",
    "Long-standing traditions",
    "Decades of tension"
  ],
  answer:"Immediate job opportunity",
  hint:{why:"Short-term causes act as triggers.", keyPoints:["Trigger"]}
},

{
  cs:"CS3",
  prompt:"Two events occur at the same time. Before concluding one caused the other, a historian must:",
  choices:[
    "Gather evidence linking the events",
    "Assume causation",
    "Ignore the relationship",
    "Focus on sequence only"
  ],
  answer:"Gather evidence linking the events",
  hint:{why:"Correlation alone is not proof.", keyPoints:["Evidence required"]}
},

{
  cs:"CS3",
  prompt:"Which statement BEST shows cause-and-effect reasoning?",
  choices:[
    "Because factories offered jobs, more people moved to cities.",
    "Factories existed.",
    "Cities were crowded.",
    "History changed."
  ],
  answer:"Because factories offered jobs, more people moved to cities.",
  hint:{why:"Clear causal link.", keyPoints:["Because → effect"]}
},

{
  cs:"CS3",
  prompt:"An economic downturn leads to unemployment, which then leads to unrest. This is:",
  choices:[
    "A cause-and-effect chain",
    "Correlation only",
    "Bias analysis",
    "Primary sourcing"
  ],
  answer:"A cause-and-effect chain",
  hint:{why:"Effects can become new causes.", keyPoints:["Chain"]}
},

{
  cs:"CS3",
  prompt:"Which BEST distinguishes correlation from causation?",
  choices:[
    "Correlation suggests relationship; causation proves production of effect",
    "They are identical",
    "Correlation proves cause",
    "Causation means events happened together"
  ],
  answer:"Correlation suggests relationship; causation proves production of effect",
  hint:{why:"Proof requires evidence.", keyPoints:["Suggest vs prove"]}
},

{
  cs:"CS3",
  prompt:"Which scenario BEST reflects both long- and short-term causes?",
  choices:[
    "Long-term discrimination plus sudden job demand triggers migration",
    "One law explains everything",
    "Weather causes policy",
    "Order doesn’t matter"
  ],
  answer:"Long-term discrimination plus sudden job demand triggers migration",
  hint:{why:"Many events combine structural and trigger causes.", keyPoints:["Multiple layers"]}
},

{
  cs:"CS3",
  prompt:"A historian argues Event A caused Event B but only shows that A happened first. What is missing?",
  choices:[
    "Evidence explaining how A produced B",
    "A longer timeline",
    "A secondary source",
    "An opinion poll"
  ],
  answer:"Evidence explaining how A produced B",
  hint:{why:"Sequence alone doesn’t prove causation.", keyPoints:["Mechanism"]}
},

{
  cs:"CS3",
  prompt:"Which is NOT an example of cause-and-effect reasoning?",
  choices:[
    "Because unemployment rose, protests increased.",
    "Factories expanded, and cities grew.",
    "Economic hardship led to migration.",
    "The protest happened after the speech."
  ],
  answer:"The protest happened after the speech.",
  hint:{why:"Sequence alone is not causation.", keyPoints:["Order ≠ cause"]}
}

];
/* =========
   ENGINE — FIRST-TRY ACCURACY (Block 7 / Block 12 style)
   ========= */
const $ = (s)=>document.querySelector(s);
const screens = { start: $("#screenStart"), game: $("#screenGame"), done: $("#screenDone") };
const meta = { name: $("#mName"), start: $("#mStart"), time: $("#mTime"), acc: $("#mAcc") };
const qUI = {
  kicker: $("#qKicker"), text: $("#qText"), choices: $("#choices"),
  count: $("#qCount"), total: $("#qTotal"), bar: $("#barFill"),
  feedback: $("#feedback"),
  hintBox: $("#hintBox"), hintText: $("#hintText"), hintSmall: $("#hintSmall")
};

let state = {
  startedAt:null, timerId:null,
  idx:0,
  questionsCompleted:0,
  correctFirst:0,
  misses:0,                 // counts ONCE per question
  missedThisQuestion:false,
  qOrder:[]
};

$("#btnDemo").addEventListener("click", ()=>{ $("#name").value="Demo Student"; $("#name").focus(); });
$("#btnStart").addEventListener("click", startGame);
$("#btnReset").addEventListener("click", resetAll);
$("#btnPlayAgain").addEventListener("click", resetAll);
$("#btnCopy").addEventListener("click", async ()=>{
  try{
    await navigator.clipboard.writeText($("#logOut").innerText);
    $("#btnCopy").textContent="Copied ✅";
    setTimeout(()=>$("#btnCopy").textContent="Copy Ticket", 1100);
  }catch(e){
    alert("Copy failed. You can manually select and copy the ticket text.");
  }
});

function calcAccuracy(){
  if(state.questionsCompleted <= 0) return 100;
  return Math.round((state.correctFirst / state.questionsCompleted) * 100);
}
function updateAccuracy(){
  meta.acc.textContent = `${calcAccuracy()}%`;
}

function shuffledChoices(q){
  const arr = [...q.choices];
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

function drawChoices(q){
  qUI.choices.innerHTML = "";
  shuffledChoices(q).forEach(choice=>{
    const btn = document.createElement("button");
    btn.textContent = choice;
    btn.addEventListener("click", ()=>submit(choice));
    qUI.choices.appendChild(btn);
  });
}

function startGame(){
  const n = ($("#name").value||"").trim();
  if(!n){ alert("Please enter your name."); return; }

  state.startedAt = new Date();
  meta.name.textContent = n;
  meta.start.textContent = stamp(state.startedAt);
  meta.time.textContent = "00:00";

  state.qOrder = shuffle([...QUESTIONS]);
  state.idx = 0;
  state.questionsCompleted = 0;
  state.correctFirst = 0;
  state.misses = 0;
  state.missedThisQuestion = false;

  $("#qTotal").textContent = String(state.qOrder.length);
  updateAccuracy();

  switchTo("game");
  startTimer();
  renderQuestion();
}

function renderQuestion(){
  const q = state.qOrder[state.idx];
  if(!q) return finish();

  state.missedThisQuestion = false;

  qUI.kicker.textContent = `${q.cs} • Question ${state.idx+1}`;
  qUI.text.textContent = q.prompt;

  qUI.count.textContent = String(state.idx+1);
  qUI.total.textContent = String(state.qOrder.length);
  qUI.bar.style.width = `${Math.round((state.idx/state.qOrder.length)*100)}%`;

  qUI.feedback.textContent = "Choose the best answer.";
  qUI.feedback.style.color = "var(--muted)";

  qUI.hintBox.style.display = "none";
  qUI.hintText.textContent = "";
  qUI.hintSmall.textContent = "";

  drawChoices(q);
}

function submit(choice){
  const q = state.qOrder[state.idx];

  if(choice === q.answer){
    state.questionsCompleted++;
    if(!state.missedThisQuestion) state.correctFirst++;
    updateAccuracy();

    qUI.feedback.textContent = "Correct ✅";
    qUI.feedback.style.color = "var(--good)";
    flashButtons(choice, true);

    setTimeout(()=>{
      state.idx++;
      renderQuestion();
    }, 320);
    return;
  }

  // first wrong on this question counts as a miss ONCE
  if(!state.missedThisQuestion){
    state.misses++;
    state.missedThisQuestion = true;
    updateAccuracy();
  }

  qUI.feedback.textContent = "Not yet ❌ Try again.";
  qUI.feedback.style.color = "var(--bad)";
  flashButtons(choice, false);

  qUI.hintBox.style.display = "block";
  qUI.hintText.textContent = q.hint?.why || "Think back to the historical thinking skill being tested.";
  qUI.hintSmall.textContent = q.hint?.keyPoints?.length
    ? ("Key points: " + q.hint.keyPoints.join(" • "))
    : "";

  // ✅ reshuffle choices after a miss (and after any wrong click)
  drawChoices(q);
}

function finish(){
  stopTimer();
  qUI.bar.style.width = "100%";

  const endedAt = new Date();
  const durationSec = Math.floor((endedAt - state.startedAt)/1000);
  const accuracy = calcAccuracy();

  if(state.misses > 0){
    $("#doneTitle").textContent = "Not Passed ❌";
    $("#doneMsg").textContent = "You finished, but this attempt had missed questions. Retake for a perfect run to earn the submit ticket.";
    $("#btnCopy").style.display = "none";

    $("#logOut").textContent =
`NOT PASSED — Retake Required

Student: ${meta.name.textContent}
Started: ${stamp(state.startedAt)}
Ended:   ${stamp(endedAt)}
Duration (sec): ${durationSec}
First-try Accuracy: ${accuracy}%
Missed Questions: ${state.misses}

RULE: To earn a submit ticket, you must complete the game with 0 missed questions (100% first-try accuracy).`;
    switchTo("done");
    return;
  }

  $("#doneTitle").textContent = "Complete ✅";
  $("#doneMsg").textContent = "Perfect run achieved (0 missed questions). Copy your submit ticket.";
  $("#btnCopy").style.display = "inline-flex";

  const ticket = {
    status: "PASSED",
    game: "American History — Block 13 (CS 1–3)",
    student: meta.name.textContent,
    started: stamp(state.startedAt),
    ended: stamp(endedAt),
    duration_seconds: durationSec,
    total_questions: state.qOrder.length,
    questions_completed: state.questionsCompleted,
    missed_questions: state.misses,
    first_try_accuracy_percent: 100
  };

  $("#logOut").textContent = JSON.stringify(ticket, null, 2);
  switchTo("done");
}

function switchTo(which){
  Object.values(screens).forEach(el=>el.classList.add("hidden"));
  screens[which].classList.remove("hidden");
}

function startTimer(){
  stopTimer();
  state.timerId = setInterval(()=>{
    const s = Math.floor((new Date() - state.startedAt)/1000);
    meta.time.textContent = fmtTime(s);
  }, 250);
}
function stopTimer(){
  if(state.timerId){ clearInterval(state.timerId); state.timerId=null; }
}

function resetAll(){
  stopTimer();
  meta.name.textContent="—";
  meta.start.textContent="—";
  meta.time.textContent="00:00";
  meta.acc.textContent="100%";
  $("#name").value="";
  $("#btnCopy").textContent="Copy Ticket";
  $("#btnCopy").style.display = "inline-flex";
  switchTo("start");
}

function fmtTime(sec){
  const m = String(Math.floor(sec/60)).padStart(2,"0");
  const s = String(sec%60).padStart(2,"0");
  return `${m}:${s}`;
}
function stamp(d){
  return d.toLocaleString(undefined, {
    year:"numeric", month:"2-digit", day:"2-digit",
    hour:"2-digit", minute:"2-digit", second:"2-digit"
  });
}
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}
function flashButtons(choice, correct){
  [...qUI.choices.querySelectorAll("button")].forEach(b=>{
    if(b.textContent === choice){
      b.classList.add(correct ? "good" : "bad");
      setTimeout(()=>b.classList.remove("good","bad"), 320);
    }
  });
}
</script>
</body>
</html>
